<% content_for :title, "Modifier mon profil - Repreneur - Idéal Reprise" %>

<div class="max-w-4xl mx-auto space-y-6">
  <% if flash[:notice] %>
    <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg flex items-start gap-3">
      <svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <p class="font-medium"><%= flash[:notice] %></p>
      </div>
    </div>
  <% end %>

  <% if flash[:alert] %>
    <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start gap-3">
      <svg class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <p class="font-medium"><%= flash[:alert] %></p>
        <% if defined?(@errors) && @errors.any? %>
          <ul class="mt-2 text-sm list-disc list-inside">
            <% @errors.each do |error| %>
              <li><%= error %></li>
            <% end %>
          </ul>
        <% end %>
      </div>
    </div>
  <% end %>

  <%= link_to buyer_profile_path, class: "inline-flex items-center gap-2 text-gray-600 hover:text-gray-900" do %>
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
    </svg>
    Retour à mon profil
  <% end %>

  <div>
    <h1 class="text-2xl font-bold text-gray-900">Modifier mon profil repreneur</h1>
    <p class="text-buyer-600 font-medium mt-1">Complétude: <%= @profile.completeness_score %>%</p>
  </div>

  <%= form_with model: @profile, url: buyer_profile_path, method: :patch, local: true, data: { turbo: false }, class: "space-y-6" do |f| %>
    
    <!-- Type de repreneur -->
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Type de repreneur</h3>
      
      <div class="space-y-3">
        <%= f.label :buyer_type, "Type de repreneur *", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.select :buyer_type, 
          options_for_select([
            ['Personne physique', 'individual'],
            ['Holding / Société', 'holding'],
            ['Fond d\'investissement', 'fund'],
            ['Investisseur', 'investor']
          ], @profile.buyer_type),
          { include_blank: 'Sélectionnez un type' },
          class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
        %>
      </div>
    </div>

    <!-- Formation et Expérience -->
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Formation et Expérience</h3>
      
      <div class="space-y-4">
        <div data-controller="char-counter" data-char-counter-max-value="200">
          <%= f.label :formation, "Formation *", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :formation, 
            rows: 2,
            placeholder: "Ex: MBA, formation en reprise d'entreprise...",
            class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",
            data: { char_counter_target: "input", action: "input->char-counter#input" }
          %>
        </div>

        <div data-controller="char-counter" data-char-counter-max-value="300">
          <%= f.label :experience, "Expérience *", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :experience, 
            rows: 2,
            placeholder: "Décrivez votre parcours professionnel...",
            class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",
            data: { char_counter_target: "input", action: "input->char-counter#input" }
          %>
        </div>

        <div data-controller="char-counter" data-char-counter-max-value="200">
          <%= f.label :skills, "Compétences (200 car max) *", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_area :skills, 
            rows: 2,
            maxlength: 200,
            placeholder: "Management, Marketing Digital, Commercial, Finance...",
            class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",
            data: { char_counter_target: "input", action: "input->char-counter#input" }
          %>
          <p class="text-xs text-gray-500 mt-1" data-char-counter-target="counter"></p>
        </div>
      </div>
    </div>

    <!-- Thèse de reprise -->
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Thèse de reprise</h3>
      
      <div data-controller="char-counter" data-char-counter-max-value="500">
        <%= f.label :investment_thesis, "Thèse de reprise (500 car max) *", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :investment_thesis, 
          rows: 4,
          maxlength: 500,
          placeholder: "Décrivez votre projet de reprise, vos motivations et objectifs...",
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500",
          data: { char_counter_target: "input", action: "input->char-counter#input" }
        %>
        <p class="text-xs text-gray-500 mt-1" data-char-counter-target="counter"></p>
      </div>
    </div>

    <!-- Critères de recherche -->
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Entreprise recherchée</h3>
      
      <div class="space-y-4">
        <div>
          <%= f.label :target_sectors, "Secteurs d'activité", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :target_sectors,
            options_for_select([
              'Industrie',
              'Construction (BTP)',
              'Commerce & Distribution',
              'Transport & Logistique',
              'Hôtellerie / Restauration',
              'Services',
              'Agri-food & Agriculture',
              'Santé',
              'Digital',
              'Immobilier',
              'Autre'
            ], @profile.target_sectors),
            {},
            { multiple: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" }
          %>
          <p class="text-xs text-gray-500 mt-1">Maintenez Ctrl (ou Cmd sur Mac) pour sélectionner plusieurs secteurs</p>
        </div>

        <div>
          <%= f.label :target_locations, "Localisations", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :target_locations,
            options_for_select([
              'Île-de-France',
              'Auvergne-Rhône-Alpes',
              'Provence-Alpes-Côte d\'Azur',
              'Nouvelle-Aquitaine',
              'Occitanie',
              'Hauts-de-France',
              'Bretagne',
              'Grand Est',
              'Pays de la Loire',
              'Normandie',
              'Bourgogne-Franche-Comté',
              'Centre-Val de Loire',
              'Corse',
              'Toute France'
            ], @profile.target_locations),
            {},
            { multiple: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" }
          %>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :target_revenue_min, "CA minimum (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :target_revenue_min, 
              step: 1000,
              placeholder: "500000",
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
            %>
          </div>
          <div>
            <%= f.label :target_revenue_max, "CA maximum (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :target_revenue_max, 
              step: 1000,
              placeholder: "2000000",
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
            %>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= f.label :target_employees_min, "Effectif minimum", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :target_employees_min, 
              min: 0,
              placeholder: "5",
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
            %>
          </div>
          <div>
            <%= f.label :target_employees_max, "Effectif maximum", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.number_field :target_employees_max, 
              min: 0,
              placeholder: "50",
              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
            %>
          </div>
        </div>

        <div>
          <%= f.label :target_financial_health, "Santé financière recherchée", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :target_financial_health,
            options_for_select([
              ['En bonne santé', 'in_bonis'],
              ['En difficulté', 'in_difficulty'],
              ['Les deux', 'both']
            ], @profile.target_financial_health),
            { include_blank: 'Sélectionnez' },
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
          %>
        </div>

        <div>
          <%= f.label :target_horizon, "Horizon de transmission", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :target_horizon, 
            placeholder: "Ex: Immédiat, 6 mois, 1 an...",
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
          %>
        </div>

        <div>
          <%= f.label :target_transfer_types, "Types de transmission", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :target_transfer_types,
            options_for_select([
              'Cession de fonds de commerce',
              'Cession de parts (partielle)',
              'Cession de parts (totale)',
              'Cession d\'actifs'
            ], @profile.target_transfer_types),
            {},
            { multiple: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" }
          %>
        </div>

        <div>
          <%= f.label :target_customer_types, "Types de clientèle", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :target_customer_types,
            options_for_select([
              'B2B',
              'B2C',
              'Mixte'
            ], @profile.target_customer_types),
            {},
            { multiple: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" }
          %>
        </div>
      </div>
    </div>

    <!-- Données financières (privées) -->
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <div class="flex items-center gap-2 mb-4">
        <h3 class="text-lg font-bold text-gray-900">Données confidentielles</h3>
      </div>
      
      <div class="space-y-4">
        <div>
          <%= f.label :linkedin_url, "LinkedIn", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.url_field :linkedin_url, 
            placeholder: "https://www.linkedin.com/in/...",
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
          %>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex gap-3">
      <%= link_to buyer_profile_path, class: "px-6 py-3 border border-gray-300 rounded-lg" do %>
        Annuler
      <% end %>
      <%= f.submit "Enregistrer", class: "flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700" %>
    </div>

    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
      <div class="flex gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <div class="text-sm text-blue-800">
          <p><strong>Score de complétude :</strong> Plus votre profil est complet, plus vous augmentez vos chances d'être contacté par des cédants sérieux.</p>
          <p class="mt-1">Score actuel : <strong><%= @profile.completeness_score %>%</strong></p>
        </div>
      </div>
    </div>
  <% end %>
</div>
