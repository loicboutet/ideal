<% content_for :title, "Modifier le dossier - Id√©al Reprise" %>
<% content_for :page_title, "Modifier mes notes" %>

<div class="max-w-3xl mx-auto space-y-6">
  <!-- Back Navigation -->
  <div>
    <%= link_to buyer_deal_path(@deal), class: "inline-flex items-center text-sm text-buyer-600 hover:text-buyer-700" do %>
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
      Retour au dossier
    <% end %>
  </div>

  <!-- Deal Summary -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <div class="flex items-start gap-4">
      <div class="flex-shrink-0">
        <div class="w-12 h-12 bg-buyer-100 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-buyer-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
      </div>
      <div class="flex-1">
        <h2 class="text-lg font-bold text-gray-900 mb-1">
          <%= @deal.listing.title || 'Entreprise' %>
        </h2>
        <div class="flex items-center gap-2">
          <span class="px-2 py-1 bg-<%= stage_color(@deal.status) %>-100 text-<%= stage_color(@deal.status) %>-700 rounded text-xs font-medium">
            <%= stage_icon(@deal.status) %> <%= stage_label(@deal.status) %>
          </span>
          <span class="text-sm text-gray-500">
            CA: <%= number_to_currency(@deal.listing.annual_revenue, unit: '‚Ç¨', precision: 0) %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Form -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h3 class="text-lg font-bold text-gray-900 mb-6">Modifier mes notes</h3>

    <%= form_with model: @deal, url: buyer_deal_path(@deal), method: :patch, local: true, class: "space-y-6" do |f| %>
      <!-- Error Messages -->
      <% if @deal.errors.any? %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
          <div class="flex">
            <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-red-800">
                <%= pluralize(@deal.errors.count, "erreur") %> d√©tect√©e<%= 's' if @deal.errors.count > 1 %>
              </h3>
              <ul class="mt-2 text-sm text-red-700 list-disc list-inside">
                <% @deal.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Notes Field -->
      <div>
        <%= f.label :notes, "Mes notes sur ce dossier", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :notes, 
          rows: 12,
          placeholder: "Ajoutez vos notes, impressions, points √† discuter, questions √† poser au c√©dant...",
          class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-buyer-500 focus:border-buyer-500 transition" %>
        <p class="mt-2 text-sm text-gray-500">
          Ces notes sont priv√©es et visibles uniquement par vous. Utilisez cet espace pour documenter votre analyse, vos √©changes et votre strat√©gie.
        </p>
      </div>

      <!-- Quick Tips -->
      <div class="bg-buyer-50 border border-buyer-200 rounded-lg p-4">
        <h4 class="text-sm font-semibold text-buyer-900 mb-2">üí° Suggestions de notes</h4>
        <ul class="text-sm text-buyer-700 space-y-1 list-disc list-inside">
          <li>Points forts et faiblesses identifi√©s</li>
          <li>Questions √† poser lors du prochain √©change</li>
          <li>R√©sum√© des discussions avec le c√©dant</li>
          <li>Analyse financi√®re et points d'attention</li>
          <li>Strat√©gie de n√©gociation et prix cible</li>
          <li>Actions √† mener avant la prochaine √©tape</li>
        </ul>
      </div>

      <!-- Actions -->
      <div class="flex items-center justify-between pt-4 border-t border-gray-200">
        <%= link_to "Annuler", buyer_deal_path(@deal), 
          class: "px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition font-medium" %>
        
        <%= f.submit "Enregistrer les modifications", 
          class: "px-6 py-2 bg-buyer-600 text-white rounded-lg hover:bg-buyer-700 transition font-medium shadow-sm" %>
      </div>
    <% end %>
  </div>

  <!-- Additional Info -->
  <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
    <div class="flex items-start gap-3">
      <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div class="text-sm text-gray-600">
        <p class="font-medium text-gray-900 mb-1">√Ä propos des notes de dossier</p>
        <p>Vos notes sont automatiquement sauvegard√©es et restent accessibles m√™me si vous lib√©rez le dossier. Elles constituent un historique pr√©cieux de votre analyse et de vos r√©flexions.</p>
      </div>
    </div>
  </div>
</div>
