<%= form_with(model: [:seller, @listing], local: true, class: "space-y-6") do |f| %>
  <% if @listing.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex gap-3">
        <svg class="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <div class="text-sm text-red-800">
          <p><strong><%= pluralize(@listing.errors.count, "erreur") %> <%= @listing.errors.count > 1 ? "ont empêché" : "a empêché" %> l'enregistrement :</strong></p>
          <ul class="mt-2 list-disc list-inside">
            <% @listing.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <!-- SECTION 1: Informations de base -->
  <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
    <h3 class="text-xl font-bold text-gray-900 mb-6">Informations de base</h3>
    
    <div class="space-y-6">
      <!-- Titre -->
      <div>
        <%= f.label :title, "Titre de l'annonce", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <span class="text-red-500">*</span>
        <%= f.text_field :title, placeholder: "Ex: Boulangerie artisanale, Restaurant italien, Agence digitale...", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        <p class="text-xs text-gray-500 mt-1">Ne mettez pas le nom exact de votre entreprise</p>
      </div>

      <!-- Secteur -->
      <div>
        <%= f.label :industry_sector, "Secteur d'activité", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <span class="text-red-500">*</span>
        <%= f.select :industry_sector, 
          options_for_select([
            ['Sélectionnez...', ''],
            ['Industrie', 'industry'],
            ['BTP', 'construction'],
            ['Commerce & Distribution', 'commerce'],
            ['Transport & logistique', 'transport_logistics'],
            ['Hôtellerie / Restauration', 'hospitality'],
            ['Services', 'services'],
            ['Agroalimentaire & Agriculture', 'agrifood'],
            ['Santé', 'healthcare'],
            ['Digital', 'digital'],
            ['Immobilier', 'real_estate'],
            ['Autre', 'other']
          ], @listing.industry_sector),
          {},
          class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
      </div>

      <!-- Localisation -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <%= f.label :location_department, "Département", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :location_department, placeholder: "75", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :location_region, "Région", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :location_region, placeholder: "Île-de-France", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :location_city, "Ville", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :location_city, placeholder: "Paris", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <!-- Description publique -->
      <div>
        <%= f.label :description_public, "Description publique", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :description_public, rows: 4, placeholder: "Description générale visible par tous (sans informations confidentielles)...", class: "w-full px-4 py-2 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-seller-500" %>
        <p class="text-xs text-gray-500 mt-1">Ne mentionnez pas le nom de l'entreprise ni d'éléments identifiables</p>
      </div>

      <!-- Description confidentielle -->
      <div>
        <%= f.label :description_confidential, "Description confidentielle", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_area :description_confidential, rows: 4, placeholder: "Informations détaillées réservées aux acheteurs qualifiés...", class: "w-full px-4 py-2 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-seller-500" %>
        <p class="text-xs text-gray-500 mt-1">Ces informations ne seront visibles qu'après signature d'un NDA</p>
      </div>
    </div>
  </div>

  <!-- SECTION 2: Données financières -->
  <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
    <h3 class="text-xl font-bold text-gray-900 mb-6">Données financières</h3>
    
    <div class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :annual_revenue, "Chiffre d'affaires annuel (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :annual_revenue, placeholder: "450000", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :net_profit, "Résultat net (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :net_profit, placeholder: "85000", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <div>
        <%= f.label :employee_count, "Effectif", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :employee_count, placeholder: "5", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        <p class="text-xs text-gray-500 mt-1">Nombre de salariés</p>
      </div>
    </div>
  </div>

  <!-- SECTION 3: Prix et conditions -->
  <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
    <h3 class="text-xl font-bold text-gray-900 mb-6">Prix et conditions</h3>
    
    <div class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <%= f.label :asking_price, "Prix demandé (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :asking_price, placeholder: "350000", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :price_min, "Prix minimum (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :price_min, placeholder: "300000", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :price_max, "Prix maximum (€)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :price_max, placeholder: "400000", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :transfer_horizon, "Horizon pour transmission", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :transfer_horizon, placeholder: "6-12 mois", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :transfer_type, "Type de transmission", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :transfer_type, 
            options_for_select([
              ['Sélectionnez...', ''],
              ['Fond de commerce', 'asset_sale'],
              ['Cession de titres partielle', 'partial_shares'],
              ['Cession de titres totale', 'total_shares'],
              ['Cession d\'actifs', 'assets']
            ], @listing.transfer_type),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :company_age, "Ancienneté entreprise (années)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :company_age, placeholder: "15", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :customer_type, "Type de clients", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :customer_type, 
            options_for_select([
              ['Sélectionnez...', ''],
              ['B2B uniquement', 'b2b'],
              ['B2C uniquement', 'b2c'],
              ['Mixte (B2B et B2C)', 'mixed']
            ], @listing.customer_type),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :legal_form, "Forme juridique", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.text_field :legal_form, placeholder: "SARL, SAS, etc.", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div>
          <%= f.label :website, "Site web", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.url_field :website, placeholder: "https://exemple.fr", class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <%= f.label :deal_type, "Type de mandat", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.select :deal_type, 
            options_for_select([
              ['Vente directe', 'direct'],
              ['Mandat Idéal Reprise', 'ideal_mandate'],
              ['Mandat partenaire', 'partner_mandate']
            ], @listing.deal_type),
            {},
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
        <div class="flex items-end">
          <label class="flex items-center gap-2">
            <%= f.check_box :show_scorecard_stars, class: "rounded border-gray-300 text-seller-600 focus:ring-seller-500" %>
            <span class="text-sm text-gray-700">Afficher les étoiles de notation</span>
          </label>
        </div>
      </div>

      <% if @listing.show_scorecard_stars %>
        <div>
          <%= f.label :scorecard_stars, "Nombre d'étoiles (0-5)", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :scorecard_stars, min: 0, max: 5, step: 0.5, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-seller-500" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex items-center justify-between pt-4">
    <%= link_to seller_listings_path, class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-medium" do %>
      Annuler
    <% end %>
    <div class="flex gap-3">
      <%= f.submit "Enregistrer comme brouillon", name: "draft", class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-medium" %>
      <%= f.submit "Soumettre pour validation", name: "submit_for_validation", class: "px-6 py-3 bg-seller-600 text-white rounded-lg hover:bg-seller-700 transition font-medium" %>
    </div>
  </div>
<% end %>
