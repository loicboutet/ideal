<% content_for :title, "Nouveau Message - Administration - Idéal Reprise" %>

<div class="max-w-4xl mx-auto space-y-6">
  <!-- Header -->
  <div class="flex items-center gap-4">
    <%= link_to admin_messages_path, class: "p-2 hover:bg-gray-100 rounded-lg transition" do %>
      <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
    <% end %>
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Nouveau Message</h1>
      <p class="text-gray-600 mt-1">Envoyez un message ou sondage aux utilisateurs</p>
    </div>
  </div>

  <!-- Form -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
    <%= form_with model: @message, url: admin_messages_path, class: "space-y-6" do |f| %>
      
      <!-- Message Type -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Type de message</label>
        <div class="grid grid-cols-2 gap-4">
          <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition <%= @message.message_type == 'broadcast' ? 'border-admin-600 bg-admin-50' : 'border-gray-200' %>">
            <%= f.radio_button :message_type, 'broadcast', class: 'sr-only' %>
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <svg class="w-6 h-6 text-admin-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
                </svg>
                <div>
                  <p class="font-medium text-gray-900">Diffusion</p>
                  <p class="text-sm text-gray-500">Message informatif</p>
                </div>
              </div>
            </div>
          </label>

          <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition <%= @message.message_type == 'survey' ? 'border-admin-600 bg-admin-50' : 'border-gray-200' %>">
            <%= f.radio_button :message_type, 'survey', class: 'sr-only' %>
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <svg class="w-6 h-6 text-admin-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
                <div>
                  <p class="font-medium text-gray-900">Sondage</p>
                  <p class="text-sm text-gray-500">Satisfaction ou questionnaire</p>
                </div>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- Target Role -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Destinataires</label>
        <%= f.select :target_role, 
            options_for_select([
              ['Tous les utilisateurs', 'all'],
              ['Vendeurs uniquement', 'seller'],
              ['Repreneurs uniquement', 'buyer'],
              ['Partenaires uniquement', 'partner']
            ], @message.target_role),
            {},
            class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent' %>
      </div>

      <!-- Subject -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Sujet *</label>
        <%= f.text_field :subject, 
            placeholder: 'Ex: Nouvelles fonctionnalités disponibles',
            class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent',
            required: true %>
      </div>

      <!-- Body -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Message *</label>
        <%= f.text_area :body, 
            rows: 10,
            placeholder: 'Rédigez votre message ici...',
            class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent',
            required: true %>
        <p class="mt-2 text-sm text-gray-500">Le message sera formaté automatiquement dans l'email.</p>
      </div>

      <!-- Delivery Options -->
      <div class="border-t border-gray-200 pt-6">
        <h3 class="text-sm font-medium text-gray-900 mb-4">Options de livraison</h3>
        <div class="space-y-3">
          <label class="flex items-center">
            <%= f.check_box :send_email, class: 'h-4 w-4 text-admin-600 focus:ring-admin-500 border-gray-300 rounded' %>
            <span class="ml-3 text-sm text-gray-700">
              Envoyer par email
              <span class="text-gray-500">(recommandé)</span>
            </span>
          </label>

          <label class="flex items-center">
            <%= f.check_box :show_in_dashboard, class: 'h-4 w-4 text-admin-600 focus:ring-admin-500 border-gray-300 rounded' %>
            <span class="ml-3 text-sm text-gray-700">
              Afficher dans le tableau de bord
              <span class="text-gray-500">(notification in-app)</span>
            </span>
          </label>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex items-center justify-between pt-6 border-t border-gray-200">
        <%= link_to admin_messages_path, class: "px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-medium" do %>
          Annuler
        <% end %>

        <%= f.submit "Envoyer le message", class: "px-8 py-3 bg-admin-600 text-white rounded-lg hover:bg-admin-700 transition font-medium flex items-center gap-2" %>
      </div>
    <% end %>
  </div>

  <!-- Info Box -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex gap-3">
      <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div class="text-sm text-blue-800">
        <p class="font-medium mb-1">À propos de l'envoi des messages</p>
        <ul class="list-disc list-inside space-y-1 text-blue-700">
          <li>Les messages sont envoyés de manière asynchrone</li>
          <li>Les utilisateurs recevront un email si l'option est activée</li>
          <li>Les messages apparaîtront dans leur tableau de bord si l'option est activée</li>
          <li>Vous pourrez suivre le taux de lecture dans l'historique</li>
        </ul>
      </div>
    </div>
  </div>
</div>
