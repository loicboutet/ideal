<% content_for :title, "Webhook Log Details - Administration" %>

<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Webhook Log Details</h1>
      <p class="text-gray-600 mt-1">Detailed information about this webhook event</p>
    </div>
    <div class="flex items-center gap-3">
      <%= link_to admin_subscription_webhook_logs_path, 
          class: "px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition" do %>
        ‚Üê Back to Logs
      <% end %>
      <%= link_to admin_subscription_webhook_log_path(@log), 
          method: :delete,
          data: { confirm: "Are you sure you want to delete this log?" },
          class: "px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" do %>
        Delete Log
      <% end %>
    </div>
  </div>

  <!-- Log Overview -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h2 class="text-xl font-bold text-gray-900 mb-4">Event Overview</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Event Type</label>
        <p class="text-lg font-semibold text-gray-900"><%= @log.event_type_display %></p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Status</label>
        <% case @log.status %>
        <% when 'success' %>
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-green-100 text-green-800">Success</span>
        <% when 'failed' %>
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800">Failed</span>
        <% else %>
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">Pending</span>
        <% end %>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Event ID</label>
        <p class="text-sm font-mono text-gray-900"><%= @log.event_id %></p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Subscription ID</label>
        <p class="text-sm font-mono text-gray-900"><%= @log.subscription_id || 'N/A' %></p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">User</label>
        <p class="text-sm text-gray-900">
          <%= @log.user.email %>
          <span class="text-xs text-gray-500">(ID: <%= @log.user_id %>)</span>
        </p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Processed At</label>
        <p class="text-sm text-gray-900"><%= l(@log.processed_at, format: :long) if @log.processed_at %></p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-500 mb-1">Created At</label>
        <p class="text-sm text-gray-900"><%= l(@log.created_at, format: :long) %></p>
      </div>
    </div>
  </div>

  <!-- Error Message (if any) -->
  <% if @log.error_message.present? %>
    <div class="bg-red-50 rounded-xl border border-red-200 p-6">
      <h2 class="text-xl font-bold text-red-900 mb-4">Error Message</h2>
      <pre class="text-sm text-red-800 whitespace-pre-wrap font-mono"><%= @log.error_message %></pre>
    </div>
  <% end %>

  <!-- Webhook Payload -->
  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
    <h2 class="text-xl font-bold text-gray-900 mb-4">Webhook Payload</h2>
    
    <% if @log.parsed_payload %>
      <div class="bg-gray-50 rounded-lg p-4 overflow-x-auto">
        <pre class="text-sm text-gray-800 font-mono"><%= JSON.pretty_generate(@log.parsed_payload) %></pre>
      </div>
    <% else %>
      <div class="text-sm text-gray-500 italic">No payload data available</div>
    <% end %>
  </div>
</div>
